--- origsrc/gnome-settings-daemon-3.24.3/configure.ac	2017-07-22 11:29:49.000000000 -0500
+++ src/gnome-settings-daemon-3.24.3/configure.ac	2017-09-04 20:20:31.720445000 -0500
@@ -164,14 +164,14 @@ PKG_CHECK_MODULES(COLOR,
 		  libcanberra-gtk3
 		  libgeoclue-2.0 >= $GEOCLUE_REQUIRED_VERSION
 		  lcms2 >= $LCMS_REQUIRED_VERSION
-		  libnotify)
+		  libnotify,[],[with_colord=no])
 
 PKG_CHECK_MODULES(DATETIME,
 		  libnotify >= $LIBNOTIFY_REQUIRED_VERSION
 		  libgeoclue-2.0 >= $GEOCLUE_REQUIRED_VERSION
 		  geocode-glib-1.0 >= $GEOCODE_GLIB_REQUIRED_VERSION
 		  gweather-3.0 >= $LIBGWEATHER_REQUIRED_VERSION
-		  polkit-gobject-1 >= $POLKIT_REQUIRED_VERSION)
+		  polkit-gobject-1 >= $POLKIT_REQUIRED_VERSION,[],[with_datetime=no])
 
 PKG_CHECK_MODULES(DUMMY,
 		  gio-2.0
@@ -192,7 +192,7 @@ PKG_CHECK_MODULES(MEDIA_KEYS,
 		  $GUDEV_PKG
 		  libpulse-mainloop-glib >= $PA_REQUIRED_VERSION
 		  libcanberra-gtk3
-		  upower-glib >= $UPOWER_REQUIRED_VERSION)
+		  )
 PKG_CHECK_MODULES(GVC,
 		  gobject-2.0
 		  libpulse >= $PA_REQUIRED_VERSION
@@ -218,7 +218,7 @@ PKG_CHECK_MODULES(POWER,
 		  $GUDEV_PKG
 		  libcanberra-gtk3
 		  libnotify
-		  x11 xext xtst)
+		  x11 xext xtst,[],[with_power=no])
 
 if test x$have_gudev != xno; then
 	PKG_CHECK_MODULES(BACKLIGHT_HELPER,
@@ -248,7 +248,7 @@ PKG_CHECK_MODULES(XSETTINGS,
 
 PKG_CHECK_MODULES(XRANDR,
 		  gnome-desktop-3.0 >= $GNOME_DESKTOP_REQUIRED_VERSION
-		  upower-glib >= $UPOWER_REQUIRED_VERSION)
+		 )
 
 dnl ---------------------------------------------------------------------------
 dnl - XTest
--- origsrc/gnome-settings-daemon-3.24.3/plugins/Makefile.am	2017-07-22 11:16:57.000000000 -0500
+++ src/gnome-settings-daemon-3.24.3/plugins/Makefile.am	2017-09-04 20:20:54.287758300 -0500
@@ -4,10 +4,7 @@ enabled_plugins =	\
 	a11y-keyboard	\
 	a11y-settings	\
 	clipboard	\
-	color		\
-	datetime	\
 	dummy		\
-	power		\
 	housekeeping    \
 	keyboard	\
 	media-keys	\
--- origsrc/gnome-settings-daemon-3.24.3/plugins/media-keys/gsd-media-keys-manager.c	2017-09-04 20:13:23.494626800 -0500
+++ src/gnome-settings-daemon-3.24.3/plugins/media-keys/gsd-media-keys-manager.c	2017-09-04 20:25:32.497426800 -0500
@@ -39,7 +39,9 @@
 #include <gio/gdesktopappinfo.h>
 #include <gio/gunixfdlist.h>
 
+#ifdef HAVE_UPOWER
 #include <libupower-glib/upower.h>
+#endif
 #include <gdesktop-enums.h>
 
 #ifdef HAVE_GUDEV
@@ -174,6 +176,7 @@ struct GsdMediaKeysManagerPrivate
         char            *icon_theme;
         char            *gtk_theme;
 
+#ifdef HAVE_UPOWER
         /* Power stuff */
         GSettings       *power_settings;
         GDBusProxy      *power_proxy;
@@ -181,6 +184,7 @@ struct GsdMediaKeysManagerPrivate
         GDBusProxy      *power_keyboard_proxy;
         UpDevice        *composite_device;
         char            *chassis_type;
+#endif
 
         /* Shell stuff */
         GsdShell        *shell_proxy;
@@ -1963,6 +1967,7 @@ do_toggle_contrast_action (GsdMediaKeysM
 	}
 }
 
+#ifdef HAVE_UPOWER
 static void
 power_action (GsdMediaKeysManager *manager,
               const char          *action,
@@ -2155,6 +2160,24 @@ do_battery_action (GsdMediaKeysManager *
 
         g_free (icon_name);
 }
+#else
+static void
+do_config_power_action (GsdMediaKeysManager *manager,
+                        GsdPowerActionType   action_type,
+                        gboolean             in_lock_screen)
+{}
+static void
+do_config_power_button_action (GsdMediaKeysManager *manager,
+                               gboolean             in_lock_screen)
+{}
+static void
+do_brightness_action (GsdMediaKeysManager *manager,
+                      MediaKeyType type)
+{}
+static void
+do_battery_action (GsdMediaKeysManager *manager)
+{}
+#endif
 
 static gboolean
 get_rfkill_property (GsdMediaKeysManager *manager,
@@ -2876,9 +2899,11 @@ start_media_keys_idle_cb (GsdMediaKeysMa
           g_hash_table_new_full (g_str_hash, g_str_equal,
                                  g_free, g_object_unref);
 
+#ifdef HAVE_UPOWER
         /* for the power plugin interface code */
         manager->priv->power_settings = g_settings_new (SETTINGS_POWER_DIR);
         manager->priv->chassis_type = gnome_settings_get_chassis_type ();
+#endif
 
         /* Logic from http://git.gnome.org/browse/gnome-shell/tree/js/ui/status/accessibility.js#n163 */
         manager->priv->interface_settings = g_settings_new (SETTINGS_INTERFACE_DIR);
@@ -3003,15 +3028,17 @@ gsd_media_keys_manager_stop (GsdMediaKey
 
         g_clear_object (&priv->logind_proxy);
         g_clear_object (&priv->settings);
+#ifdef HAVE_UPOWER
         g_clear_object (&priv->power_settings);
         g_clear_object (&priv->power_proxy);
         g_clear_object (&priv->power_screen_proxy);
         g_clear_object (&priv->power_keyboard_proxy);
         g_clear_object (&priv->composite_device);
+        g_clear_pointer (&priv->chassis_type, g_free);
+#endif
         g_clear_object (&priv->mpris_controller);
         g_clear_object (&priv->screencast_proxy);
         g_clear_object (&priv->iio_sensor_proxy);
-        g_clear_pointer (&priv->chassis_type, g_free);
 
         if (priv->cancellable != NULL) {
                 g_cancellable_cancel (priv->cancellable);
@@ -3200,6 +3227,7 @@ xrandr_ready_cb (GObject             *so
         }
 }
 
+#ifdef HAVE_UPOWER
 static void
 power_ready_cb (GObject             *source_object,
                 GAsyncResult        *res,
@@ -3247,6 +3275,7 @@ power_keyboard_ready_cb (GObject
                 g_error_free (error);
         }
 }
+#endif
 
 static void
 on_bus_gotten (GObject             *source_object,
@@ -3255,7 +3284,9 @@ on_bus_gotten (GObject             *sour
 {
         GDBusConnection *connection;
         GError *error = NULL;
+#ifdef HAVE_UPOWER
         UpClient *up_client;
+#endif
 
         connection = g_bus_get_finish (res, &error);
         if (connection == NULL) {
@@ -3293,6 +3324,7 @@ on_bus_gotten (GObject             *sour
                           (GAsyncReadyCallback) xrandr_ready_cb,
                           manager);
 
+#ifdef HAVE_UPOWER
         g_dbus_proxy_new (manager->priv->connection,
                           G_DBUS_PROXY_FLAGS_NONE,
                           NULL,
@@ -3326,6 +3358,7 @@ on_bus_gotten (GObject             *sour
         up_client = up_client_new ();
         manager->priv->composite_device = up_client_get_display_device (up_client);
         g_object_unref (up_client);
+#endif
 }
 
 static void
--- origsrc/gnome-settings-daemon-3.24.3/plugins/xrandr/gsd-xrandr-manager.c	2017-07-22 11:16:57.000000000 -0500
+++ src/gnome-settings-daemon-3.24.3/plugins/xrandr/gsd-xrandr-manager.c	2017-09-04 20:26:47.653525100 -0500
@@ -36,7 +36,9 @@
 #include <gio/gio.h>
 #include <gdk/gdk.h>
 #include <gtk/gtk.h>
+#ifdef HAVE_UPOWER
 #include <libupower-glib/upower.h>
+#endif
 
 #define GNOME_DESKTOP_USE_UNSTABLE_API
 
@@ -95,7 +97,9 @@ struct GsdXrandrManagerPrivate {
         GnomeRRScreen *rw_screen;
         gboolean running;
 
+#ifdef HAVE_UPOWER
         UpClient *upower_client;
+#endif
 
         GSettings       *settings;
         GDBusNodeInfo   *introspection_data;
@@ -460,7 +464,11 @@ config_is_all_off (GnomeRRConfig *config
 static gboolean
 laptop_lid_is_closed (GsdXrandrManager *manager)
 {
+#ifdef HAVE_UPOWER
         return up_client_get_lid_is_closed (manager->priv->upower_client);
+#else
+        return FALSE;
+#endif
 }
 
 static gboolean
@@ -1228,7 +1236,9 @@ on_rr_screen_acquired (GObject      *obj
                 return;
         }
 
+#ifdef HAVE_UPOWER
         manager->priv->upower_client = up_client_new ();
+#endif
 
         log_msg ("State of screen at startup:\n");
         log_screen (manager->priv->rw_screen);
@@ -1283,11 +1293,13 @@ gsd_xrandr_manager_stop (GsdXrandrManage
                 manager->priv->rw_screen = NULL;
         }
 
+#ifdef HAVE_UPOWER
         if (manager->priv->upower_client != NULL) {
                 g_signal_handlers_disconnect_by_data (manager->priv->upower_client, manager);
                 g_object_unref (manager->priv->upower_client);
                 manager->priv->upower_client = NULL;
         }
+#endif
 
         if (manager->priv->name_id != 0) {
                 g_bus_unown_name (manager->priv->name_id);
